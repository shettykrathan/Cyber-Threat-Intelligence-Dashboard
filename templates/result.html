<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Threat Analysis Report | CTI Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <style>
    .stat-value {
      font-family: 'Share Tech Mono', monospace;
      font-size: 1.5rem;
      font-weight: bold;
    }
    .risk-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
      animation: pulse 2s infinite;
    }
  </style>
</head>
<body class="min-h-screen p-4 md:p-6">
  <div id="loader" class="loading-screen">
    <div class="text-center">
      <div class="loading-spinner mx-auto mb-4"></div>
      <div class="text-cyan-300 text-xl font-semibold">‚è≥ Loading Results...</div>
    </div>
  </div>

  <div id="main-content" class="hidden">
    <!-- Header -->
    <header class="panel mb-6 fade-in">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h1 class="text-2xl md:text-3xl font-bold text-gradient mb-2">Cyber Threat Report</h1>
          <p class="text-sm text-gray-400">
            <span class="text-cyan-300">üìÖ Scan Time:</span> {{ result.timestamp }}
          </p>
        </div>
        <nav class="flex flex-wrap gap-2">
          <a href="/" class="nav-link">üè† Home</a>
          <a href="/visuals" class="nav-link">üìà Visuals</a>
          <a href="/history" class="nav-link">üìä History</a>
        </nav>
      </div>
    </header>

    <!-- Main Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-6">
      <!-- IP Details Panel -->
      <div class="panel slide-in" style="animation-delay: 0.1s">
        <div class="flex items-center gap-2 mb-4">
          <span class="text-2xl">üåê</span>
          <h3 class="text-xl text-cyan-300 font-semibold">IP Details</h3>
        </div>
        <div class="space-y-3">
          <div>
            <p class="text-sm text-gray-400 mb-1">IP Address</p>
            <p class="text-lg font-mono text-white font-bold">{{ result.ip }}</p>
          </div>
          <div class="divider"></div>
          <div>
            <h4 class="text-cyan-300 font-semibold mb-2">üìç Geographic Information</h4>
            <ul class="space-y-2 text-sm">
              <li class="flex justify-between">
                <span class="text-gray-400">Country:</span>
                <span class="text-white font-medium">{{ result.geo.country }}</span>
              </li>
              <li class="flex justify-between">
                <span class="text-gray-400">Region:</span>
                <span class="text-white font-medium">{{ result.geo.region }}</span>
              </li>
              <li class="flex justify-between">
                <span class="text-gray-400">City:</span>
                <span class="text-white font-medium">{{ result.geo.city }}</span>
              </li>
              <li class="flex justify-between">
                <span class="text-gray-400">ISP:</span>
                <span class="text-white font-medium">{{ result.geo.isp }}</span>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- VirusTotal Panel -->
      <div class="panel slide-in" style="animation-delay: 0.2s">
        <div class="flex items-center gap-2 mb-4">
          <span class="text-2xl">üõ°Ô∏è</span>
          <h3 class="text-xl text-cyan-300 font-semibold">VirusTotal Analysis</h3>
        </div>
        <div class="space-y-3">
          <div class="grid grid-cols-2 gap-2">
            <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-2">
              <p class="text-xs text-gray-400">Harmless</p>
              <p class="stat-value text-green-400">{{ result.virustotal.last_analysis_stats.harmless }}</p>
            </div>
            <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-2">
              <p class="text-xs text-gray-400">Suspicious</p>
              <p class="stat-value text-yellow-400">{{ result.virustotal.last_analysis_stats.suspicious }}</p>
            </div>
            <div class="bg-red-500/10 border border-red-500/30 rounded-lg p-2">
              <p class="text-xs text-gray-400">Malicious</p>
              <p class="stat-value text-red-400">{{ result.virustotal.last_analysis_stats.malicious }}</p>
            </div>
            <div class="bg-gray-500/10 border border-gray-500/30 rounded-lg p-2">
              <p class="text-xs text-gray-400">Undetected</p>
              <p class="stat-value text-gray-400">{{ result.virustotal.last_analysis_stats.undetected }}</p>
            </div>
          </div>
          <div class="divider"></div>
          <div>
            <p class="text-sm text-gray-400 mb-1">Reputation Score</p>
            <p class="text-lg font-bold text-cyan-300">{{ result.virustotal.reputation }}</p>
          </div>
        </div>
      </div>

      <!-- GreyNoise Panel -->
      <div class="panel slide-in" style="animation-delay: 0.3s">
        <div class="flex items-center gap-2 mb-4">
          <span class="text-2xl">üîç</span>
          <h3 class="text-xl text-cyan-300 font-semibold">GreyNoise Intelligence</h3>
        </div>
        <div class="space-y-4">
          <div>
            <p class="text-sm text-gray-400 mb-2">Threat Score</p>
            <div class="relative">
              <div class="w-full bg-gray-700 rounded-full h-4 mb-2">
                <div class="h-4 rounded-full transition-all duration-500
                  {% if result.greynoise.score > 70 %}bg-red-500
                  {% elif result.greynoise.score > 40 %}bg-yellow-500
                  {% else %}bg-green-500{% endif %}"
                  style="width: {{ result.greynoise.score }}%"></div>
              </div>
              <p class="text-2xl font-bold text-cyan-300">{{ result.greynoise.score }}/100</p>
            </div>
          </div>
          <div class="divider"></div>
          <div>
            <p class="text-sm text-gray-400 mb-2">Classification</p>
            <div class="inline-block px-4 py-2 rounded-lg
              {% if result.greynoise.label == 'Benign' %}status-safe
              {% elif result.greynoise.label == 'Suspicious' %}status-suspicious
              {% elif result.greynoise.label == 'Malicious' %}status-danger
              {% else %}bg-gray-700/50 border border-gray-500{% endif %}">
              <span class="font-semibold">{{ result.greynoise.label }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Risk Summary -->
    <div class="panel slide-in mb-6" style="animation-delay: 0.4s">
      <h4 class="text-2xl font-bold text-cyan-300 mb-6 text-center">Risk Assessment Summary</h4>
      
      {% set gn_score = result.greynoise.score if result.greynoise and 'score' in result.greynoise else 0 %}
      {% set gn_label = result.greynoise.label if result.greynoise and 'label' in result.greynoise else '' %}
      {% set vt_malicious = result.virustotal.last_analysis_stats.malicious %}
      {% set vt_suspicious = result.virustotal.last_analysis_stats.suspicious %}

      <div class="max-w-3xl mx-auto">
        {% if vt_malicious > 2 or gn_score > 70 %}
          <div class="text-center p-6 rounded-xl bg-red-500/10 border-2 border-red-500">
            <div class="flex items-center justify-center gap-3 mb-3">
              <span class="risk-indicator bg-red-500"></span>
              <h5 class="text-2xl font-bold text-red-400">HIGH RISK</h5>
            </div>
            <p class="text-gray-300">
              This IP address shows significant signs of malicious activity. 
              VirusTotal detected <strong>{{ vt_malicious }}</strong> malicious flags, 
              and GreyNoise threat score is <strong>{{ gn_score }}/100</strong>.
            </p>
            <p class="text-sm text-gray-400 mt-3">‚ö†Ô∏è Exercise extreme caution when interacting with this IP.</p>
          </div>
        {% elif vt_suspicious > 0 or gn_label == "Suspicious" or (gn_score > 40 and gn_score <= 70) %}
          <div class="text-center p-6 rounded-xl bg-yellow-500/10 border-2 border-yellow-500">
            <div class="flex items-center justify-center gap-3 mb-3">
              <span class="risk-indicator bg-yellow-500"></span>
              <h5 class="text-2xl font-bold text-yellow-400">SUSPICIOUS</h5>
            </div>
            <p class="text-gray-300">
              This IP address may pose a potential risk. 
              {% if vt_suspicious > 0 %}
                VirusTotal flagged <strong>{{ vt_suspicious }}</strong> suspicious indicators.
              {% endif %}
              {% if gn_label == "Suspicious" %}
                GreyNoise classification: <strong>Suspicious</strong>.
              {% endif %}
            </p>
            <p class="text-sm text-gray-400 mt-3">‚ö†Ô∏è Monitor this IP and proceed with caution.</p>
          </div>
        {% else %}
          <div class="text-center p-6 rounded-xl bg-green-500/10 border-2 border-green-500">
            <div class="flex items-center justify-center gap-3 mb-3">
              <span class="risk-indicator bg-green-500"></span>
              <h5 class="text-2xl font-bold text-green-400">SAFE</h5>
            </div>
            <p class="text-gray-300">
              No malicious activity or suspicious behavior detected. 
              This IP address appears to be safe based on current threat intelligence.
            </p>
            <p class="text-sm text-gray-400 mt-3">‚úì No immediate threats identified.</p>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- Footer -->
    <footer class="text-center text-xs text-slate-500 fade-in" style="animation-delay: 0.5s">
      <p class="mb-2">Scan generated by Cyber Threat Intelligence Dashboard</p>
      <p>¬© 2025 Krathan ‚Äî Elevating Cybersecurity</p>
    </footer>
  </div>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      setTimeout(() => {
        document.getElementById("loader").classList.add("hidden");
        const content = document.getElementById("main-content");
        content.classList.remove("hidden");
        content.classList.add("fade-in");
      }, 800);
    });
  </script>
</body>
</html>
